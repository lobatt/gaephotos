{% extends "base.html" %}
 
{% block head_ex %} 
<script type="text/javascript" src="/static/js/jquery-1.3.2.min.js"></script>
<script type="text/javascript" src="/static/js/jquery.blockUI.js"></script>
<script type="text/javascript">
showalbum = function(album){
		$("#name").val(album.name);
		$("#albumid").val(album.id);
		$("#description").val(album.description);
		$("#photocount").html(album.photoslist.length);
		$("#createdate").html(album.createdate);
		$("#updatedate").html(album.updatedate);
		$("option#"+album.id).val(album.name);
		if(album.public)
		{
		   $("input[type=radio][name=public][value=true]").attr("checked",'checked');
		   $("#"+album.id).html(album.name);
		}
		else
		{
		   $("input[type=radio][name=public][value=false]").attr("checked",'checked');
		   $("#"+album.id).html(album.name+"(不公开)");
		}
};    
$(document).ready(function() {
		$("#albumselect").change(function() {
				  $("#albuminfo").html("正在获取相册信息...")
				  
				  $("#page").block({message: '<h1>正在获取相册信息...</h1>', 
		                css: { border: '1px solid #60a0c0',width:"400px" } 
		            });
				  
                  $.getJSON("{{gallery_settings.baseurl}}/admin/ajaxaction/?action=getalbum",
                    { 'albumname': $(this).val()},
                  	function(json){
	                  	 $("#page").unblock();
	                  	 if (json.result=='ok') {
	                  	 	showalbum(json.album); 
	                  	 }
	                  	 else
	                  	 {
	                  	 	alert(json.msg);
	                  	 }
                  	 });    
        }); 
        $('#save').click(function() { 
	        $("#albuminfo").html("正在保存相册设置...")
				  
				  $("#page").block({message: '<h1>正在保存相册设置...</h1>', 
		                css: { border: '1px solid #60a0c0',width:"400px" } 
		            });
				  
                  $.getJSON("{{gallery_settings.baseurl}}/admin/ajaxaction/?action=savealbum",
                    { 'albumid': $('#albumid').val(),'albumname': $('#name').val(), 
                    'description': $('#description').val(), 
                    'public': $("#public").attr('checked')},
                  	function(json){ 
	                  	 $("#page").unblock();
	                  	 if (json.result=='ok') {
	                  	 	showalbum(json.album); 
	                  	 }
	                  	 else
	                  	 {
	                  	 	alert(json.msg);
	                  	 }
                  	}); 
    	});
    	$('#clear').click(function() { 
				  $("#page").block({ message: $('#clearquestion'), css: { width: '375px' } });
    	});
    	$('#clearyes').click(function() {
    			  $("#page").unblock();
    			  $("#page").block({message: '<h1>正在清空图片...</h1>', 
		                css: { border: '1px solid #60a0c0',width:"500px" } 
		            });
				  
                  $.getJSON("{{gallery_settings.baseurl}}/admin/ajaxaction/?action=clearalbum",
                    { 'albumid': $('#albumid').val(),'albumname': $('#name').val(), 
                    'description': $('#description').val(), 
                    'public': $("#public").attr('checked')},
                  	function(json){ 
                  		 $("#page").unblock();
	                  	 if (json.result=='ok') {
	                  	 	showalbum(json.album); 
	                  	 }
	                  	 else
	                  	 {
	                  	 	alert(json.msg);
	                  	 }
					});
    	});
    	
    	$('#delete').click(function() { 
    			$("#page").block({ message: $('#deletequestion'), css: { width: '375px' } });			  
    	});
    	$('#deleteyes').click(function() {
    			$("#page").unblock();
            	$("#page").block({message: '<h1>正在删除相册...</h1>', 
		                css: { border: '1px solid #60a0c0',width:"500px" } 
		            });
				  
                $.getJSON("http://localhost:8080/admin/ajaxaction/?action=deletealbum",
                    { 'albumid': $('#albumid').val(),'albumname': $('#name').val(), 
                    'description': $('#description').val(), 
                    'public': $("#public").attr('checked')},
                  	function(json){ 
                  		$("#page").unblock();
                  		if (json.result=='ok') {
                  			$("#"+$('#albumid').val()).hide();
	                  		showalbum(json.album); 
	                  		$("#"+$('#albumid').val()).attr('selected', true); 
	                  	 }
	                  	 else
	                  	 {
	                  	 	alert('error: '+json.msg);
	                  	 }
                  	});
        });

        $('#deleteno').click( function() {$("#page").unblock(); });
        $('#clearno').click( function() {$("#page").unblock(); });
    	
});              
</script>
{% endblock %}
 
{% block page %}
<div id="page">
	<form method="post">
	<div id="albumlist">
		<p>相册列表:</p>
		<select id="albumselect" name="albumselect" size="8">
			{% for album in albums %}
			<option id="{{album.id}}" value="{{album.name}}">{{album.name}}{% if not album.public %}(不公开){% endif %}</option>
	        {% endfor %}
		</select>
		
		<p>新建相册</p>
		<div id="createalbum">
			<ul><li>名字: <input id="new_name" name="new_name" type="text" size="20" value=""/></li>
			<li><input type="radio" name="new_public" value="true" checked>公开</input>
			<input type="radio" name="new_public" value="false">不公开</input></li>
			<li>相册简介: <textarea wrap="soft" name="new_description" rows="3" cols="20"></textarea> </li>
			<li><input type="submit" value="新建相册" name="createalbum"></li></ul>
		</div>
	</div>
	<div id="albumsettings">
		<table id="admin_table">
	    <tr>
            <th scope="row">相册名字:</th>
            <td><input id="name" name="name" type="text" size="35" value=""/>
            <input id="albumid" type=hidden name="albumid" value=""> 
            </td>
        </tr>
		<tr>
            <th scope="row">相册说明:</th>
            <td><textarea id="description" wrap="soft" name="description" rows="3" cols="25"></textarea>
            </td>
        </tr>
        <tr>
            <th scope="row">权限设置:</th>
            <td><input id="public" type="radio" name="public" value="true">公开</input>
				<input type="radio" name="public" value="false">不公开</input>
            </td>
        </tr>
        <tr>
            <th scope="row">照片数量:</th>
            <td><div id="photocount"></div>
            </td>
        </tr>
        <tr>
            <th scope="row">创建时间:</th>
            <td><div id="createdate"></div>
            </td>
        </tr>
        <tr>
            <th scope="row">更新时间:</th>
            <td><div id="updatedate"></div>
            </td>
        </tr>
       <tr>
            <th scope="row"><input id="save" type="button" value="保存设置" name="save"/></th>
            <td>
            <input id="clear" type="button" value="清空本相册图片" name="clear"/>(慎重)
            <input id="delete" type="button" value="删除相册" name="delete"/>(慎慎重)
            </td>
       </tr>
	   </table>
	</div>
	</form>
	<div id="deletequestion" style="display:none; cursor: default">
        <h1>你真的要删除相册?</h1>
        <input type="button" id="deleteno" value="No,不小心点错了" />
        <input type="button" id="deleteyes" value="是的,我要删除相册" /> 
	</div>
	<div id="clearquestion" style="display:none; cursor: default">
        <h1>你真的要清空相册图片?</h1>
        <input type="button" id="clearno" value="No,不小心点错了" />
        <input type="button" id="clearyes" value="是的,我要清空图片" />
	</div>
	<div style="clear: both;">&nbsp;</div>
</div>
{% endblock %}